<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestiÃ³n de Equipamiento</title>
    <link rel="stylesheet" href="medicamentos.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>âš™ï¸ GestiÃ³n de Equipamiento MÃ©dico</h1>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="openModal()" id="btnNuevo">
                    â• Nuevo Equipamiento
                </button>
                <button class="btn btn-secondary" onclick="window.location.href='dashboard.html'">
                    â† Volver
                </button>
            </div>
        </header>

        <div class="filters">
            <input type="text" id="searchInput" placeholder="ğŸ” Buscar equipamiento..." 
                   oninput="filterEquipamientos()">
            <select id="filterEstado" onchange="filterEquipamientos()">
                <option value="">Todos los estados</option>
                <option value="Operativo">Operativo</option>
                <option value="En Mantenimiento">En Mantenimiento</option>
                <option value="Fuera de Servicio">Fuera de Servicio</option>
            </select>
            <input type="month" id="filterFecha" onchange="filterEquipamientos()" 
                   title="Filtrar por mes de mantenimiento">
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalEquipos">0</div>
                <div class="stat-label">Total Equipos</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="operativos">0</div>
                <div class="stat-label">Operativos</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="enMantenimiento">0</div>
                <div class="stat-label">En Mantenimiento</div>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>CÃ³digo</th>
                        <th>Nombre Equipo</th>
                        <th>Ãšltima Mantenimiento</th>
                        <th>PrÃ³ximo Mantenimiento</th>
                        <th>Estado</th>
                        <th>DÃ­as Restantes</th>
                        <th class="acciones-col">Acciones</th>
                    </tr>
                </thead>
                <tbody id="equipamientosBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal Crear/Editar -->
    <div id="equipamientoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Nuevo Equipamiento</h2>
            <form id="equipamientoForm" onsubmit="saveEquipamiento(event)">
                <div class="form-group">
                    <label>Nombre del Equipo *</label>
                    <input type="text" id="nombreEquip" required 
                           placeholder="Ej: Resonador MagnÃ©tico GE 3.0T">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha Ãšltimo Mantenimiento *</label>
                        <input type="date" id="fechaMantenimiento" required>
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="estado" required>
                            <option value="Operativo">Operativo</option>
                            <option value="En Mantenimiento">En Mantenimiento</option>
                            <option value="Fuera de Servicio">Fuera de Servicio</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Observaciones</label>
                    <textarea id="observaciones" rows="3" 
                              placeholder="Notas adicionales sobre el equipamiento..."></textarea>
                </div>

                <div class="alert-info">
                    â„¹ï¸ El mantenimiento preventivo se programa cada 6 meses
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" 
                            onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalles -->
    <div id="detallesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDetallesModal()">&times;</span>
            <h2>ğŸ“‹ Detalle del Equipamiento</h2>
            
            <div id="equipamientoDetalles" class="details-container">
                <!-- Se carga dinÃ¡micamente -->
            </div>

            <div class="stock-section" id="mantenimientoSection">
                <h3>ğŸ”§ Registrar Mantenimiento</h3>
                <form id="mantenimientoForm" onsubmit="registrarMantenimiento(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha de Mantenimiento</label>
                            <input type="date" id="nuevaFechaMantenimiento" required>
                        </div>
                        <div class="form-group">
                            <label>Nuevo Estado</label>
                            <select id="nuevoEstado" required>
                                <option value="Operativo">Operativo</option>
                                <option value="En Mantenimiento">En Mantenimiento</option>
                                <option value="Fuera de Servicio">Fuera de Servicio</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>DescripciÃ³n del Mantenimiento</label>
                        <textarea id="descripcionMantenimiento" rows="3" required
                                  placeholder="Detalle las actividades realizadas..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Mantenimiento</button>
                </form>
            </div>

            <div class="stock-section">
                <h3>ğŸ¢ Departamentos que Usan este Equipo</h3>
                <div id="departamentosList"></div>
                
                <button class="btn btn-primary" onclick="openAsignarModal()" id="btnAsignar">
                    â• Asignar a Departamento
                </button>
            </div>

            <div class="stock-section">
                <h3>ğŸ‘¨â€ğŸ”§ Empleados Responsables del Mantenimiento</h3>
                <div id="empleadosList"></div>
                
                <button class="btn btn-primary" onclick="openAsignarEmpleadoModal()" id="btnAsignarEmpleado">
                    â• Asignar Empleado
                </button>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeDetallesModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Asignar Departamento -->
    <div id="asignarModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAsignarModal()">&times;</span>
            <h2>ğŸ¢ Asignar a Departamento</h2>
            <form id="asignarForm" onsubmit="asignarDepartamento(event)">
                <div class="form-group">
                    <label>Sede *</label>
                    <select id="idSedeAsignar" required onchange="loadDepartamentosSede()">
                        <option value="">Seleccione sede</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Departamento *</label>
                    <select id="nombreDepartamentoAsignar" required>
                        <option value="">Seleccione departamento</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" 
                            onclick="closeAsignarModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Asignar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Asignar Empleado -->
    <div id="asignarEmpleadoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAsignarEmpleadoModal()">&times;</span>
            <h2>ğŸ‘¨â€ğŸ”§ Asignar Empleado al Mantenimiento</h2>
            <form id="asignarEmpleadoForm" onsubmit="asignarEmpleadoMantenimiento(event)">
                <div class="form-group">
                    <label>Empleado *</label>
                    <select id="empleadoSelect" required>
                        <option value="">Seleccione empleado</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" 
                            onclick="closeAsignarEmpleadoModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Asignar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="auditoria-helper.js"></script>
    <script src="equipamientos.js"></script>
</body>
</html>