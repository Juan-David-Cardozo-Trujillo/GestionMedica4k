# ============================================================
# HIS+ - Configuración Multi-DataSource Híbrida
# ============================================================

spring.application.name=HIS-Plus

# ============================================================
# DATASOURCE COMPARTIDO (Tablas Maestras)
# Ubicación: AWS RDS
# Base de Datos: his_compartida
# Tablas: Persona, Usuario, Enfermedades, Medicamentos, Sedes_Hospitalarias
# ============================================================

spring.datasource.shared.jdbc-url=jdbc:postgresql://aws-shared.rds.amazonaws.com:5432/SedeHospitalariaSur
spring.datasource.shared.username=postgres
spring.datasource.shared.password=postgres
spring.datasource.shared.driver-class-name=org.postgresql.Driver

# Pool de Conexiones Compartido
spring.datasource.shared.hikari.maximum-pool-size=15
spring.datasource.shared.hikari.minimum-idle=5
spring.datasource.shared.hikari.connection-timeout=20000
spring.datasource.shared.hikari.idle-timeout=300000
spring.datasource.shared.hikari.max-lifetime=1200000
spring.datasource.shared.hikari.pool-name=SharedHikariPool

# ============================================================
# DATASOURCE SEDE 1 (Datos Operacionales)
# Ubicación: AWS RDS
# Base de Datos: his_sede1
# Tablas: Pacientes, Empleados, Citas, Historias_Clinicas, Equipamientos, etc.
# ============================================================

spring.datasource.sede1.jdbc-url=jdbc:postgresql://aws-sede1.rds.amazonaws.com:5432/SedeHospitalariaNorte
spring.datasource.sede1.username=postgres
spring.datasource.sede1.password=postgres
spring.datasource.sede1.driver-class-name=org.postgresql.Driver

# Pool de Conexiones Sede 1
spring.datasource.sede1.hikari.maximum-pool-size=15
spring.datasource.sede1.hikari.minimum-idle=5
spring.datasource.sede1.hikari.connection-timeout=20000
spring.datasource.sede1.hikari.idle-timeout=300000
spring.datasource.sede1.hikari.max-lifetime=1200000
spring.datasource.sede1.hikari.pool-name=Sede1HikariPool

# ============================================================
# DATASOURCE SEDE 2 (Datos Operacionales)
# Ubicación: Azure PostgreSQL
# Base de Datos: his_sede2
# Tablas: Pacientes, Empleados, Citas, Historias_Clinicas, Equipamientos, etc.
# ============================================================

spring.datasource.sede2.jdbc-url=jdbc:postgresql://azure-sede2.postgres.database.azure.com:5432/his_sede2
spring.datasource.sede2.username=administrador
spring.datasource.sede2.password=4184812
spring.datasource.sede2.driver-class-name=org.postgresql.Driver

# Pool de Conexiones Sede 2
spring.datasource.sede2.hikari.maximum-pool-size=15
spring.datasource.sede2.hikari.minimum-idle=5
spring.datasource.sede2.hikari.connection-timeout=20000
spring.datasource.sede2.hikari.idle-timeout=300000
spring.datasource.sede2.hikari.max-lifetime=1200000
spring.datasource.sede2.hikari.pool-name=Sede2HikariPool

# ============================================================
# JPA / HIBERNATE (Común para todos los DataSources)
# ============================================================

spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# ============================================================
# THYMELEAF & WEB
# ============================================================

spring.thymeleaf.cache=false
spring.thymeleaf.enabled=true
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML
spring.thymeleaf.encoding=UTF-8
spring.web.resources.static-locations=classpath:/static/,classpath:/public/
spring.mvc.static-path-pattern=/**
spring.web.resources.add-mappings=true
spring.web.resources.cache.period=0
spring.resources.chain.cache=false

# ============================================================
# SERVIDOR & LOGGING
# ============================================================

server.port=8080
server.error.whitelabel.enabled=true

# Logging General
logging.level.org.springframework.web=INFO
logging.level.com.gestion_medica=DEBUG

# Logging de DataSources
logging.level.com.zaxxer.hikari=INFO
logging.level.org.springframework.jdbc=DEBUG
logging.level.com.gestion_medica.demo.config=DEBUG

# ============================================================
# CONFIGURACIÓN DE PRODUCCIÓN (Comentadas - descomentar para prod)
# ============================================================

# SSL para AWS RDS (Producción)
# spring.datasource.shared.jdbc-url=jdbc:postgresql://...?ssl=true&sslmode=require
# spring.datasource.sede1.jdbc-url=jdbc:postgresql://...?ssl=true&sslmode=require

# SSL para Azure PostgreSQL (Producción)
# spring.datasource.sede2.jdbc-url=jdbc:postgresql://...?ssl=true&sslmode=require

# ============================================================
# NOTAS DE CONFIGURACIÓN
# ============================================================

# 1. Variables de entorno recomendadas para passwords:
#    - SHARED_DB_PASSWORD
#    - SEDE1_DB_PASSWORD
#    - SEDE2_DB_PASSWORD
#
# 2. En producción, usar AWS Secrets Manager o Azure Key Vault
#
# 3. Estructura de bases de datos:
#    his_compartida (AWS)  → Persona, Usuario, Enfermedades, Medicamentos, Sedes
#    his_sede1 (AWS)       → Pacientes, Empleados, Citas, Historias, Equipamientos...
#    his_sede2 (Azure)     → Pacientes, Empleados, Citas, Historias, Equipamientos...
#
# 4. Foreign Data Wrapper (FDW) para acceso transparente:
#    Cada sede puede consultar tablas compartidas usando FDW
#    Ver scripts SQL en documentación
#
# 5. Replicación de Medicamentos:
#    Implementar replicación lógica PostgreSQL para inventarios
#    Ver guía de replicación en documentación